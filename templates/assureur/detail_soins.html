{% extends 'base.html' %}
{% load static %}

{% block title %}Détail du Soin - {{ soin.type_soin.nom }}{% endblock %}

{% block content %}
<div class="container mt-4">
    <!-- En-tête -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2>Détail du Soin</h2>
        <a href="{% url 'soins:liste_soins' %}" class="btn btn-outline-primary">
            ← Retour à la liste
        </a>
    </div>

    <!-- Carte d'information du soin -->
    <div class="card mb-4">
        <div class="card-header bg-primary text-white">
            <h5 class="card-title mb-0">
                {{ soin.type_soin.nom }}
                <span class="badge bg-{% if soin.status == 'valide' %}success{% elif soin.status == 'rejete' %}danger{% else %}warning{% endif %} float-end">
                    {{ soin.get_statut_display }}
                </span>
            </h5>
        </div>
        <div class="card-body">
            <div class="row">
                <div class="col-md-6">
                    <p><strong>Patient:</strong> {{ soin.patient.get_full_name }}</p>
                    <p><strong>Médecin:</strong> {{ soin.medecin.get_full_name }}</p>
                    <p><strong>Date de réalisation:</strong> {{ soin.date_realisation|date:"d/m/Y" }}</p>
                </div>
                <div class="col-md-6">
                    <p><strong>Coût:</strong> {{ soin.cout }} €</p>
                    <p><strong>Date de création:</strong> {{ soin.date_creation|date:"d/m/Y H:i" }}</p>
                    {% if soin.valide_par %}
                    <p><strong>Validé par:</strong> {{ soin.valide_par.get_full_name }}</p>
                    <p><strong>Date validation:</strong> {{ soin.date_validation|date:"d/m/Y H:i" }}</p>
                    {% endif %}
                </div>
            </div>
            
            {% if soin.description %}
            <div class="mt-3">
                <strong>Description:</strong>
                <p class="mt-1">{{ soin.description }}</p>
            </div>
            {% endif %}
            
            {% if soin.motif_rejet %}
            <div class="mt-3 alert alert-warning">
                <strong>Motif de rejet:</strong>
                <p class="mt-1">{{ soin.motif_rejet }}</p>
            </div>
            {% endif %}
        </div>
    </div>

    <!-- Boutons d'action pour l'assureur -->
    {% if can_validate %}
    <div class="card">
        <div class="card-header">
            <h5 class="card-title mb-0">Actions</h5>
        </div>
        <div class="card-body">
            <div class="btn-group" role="group">
                <a href="{% url 'soins:valider_soin' soin.id %}?next={% url 'soins:detail_soin' soin.id %}" 
                   class="btn btn-success"
                   onclick="return confirm('Êtes-vous sûr de vouloir valider ce soin ?')">
                   <i class="fas fa-check-circle"></i> Valider le soin
                </a>
                <a href="{% url 'soins:rejeter_soin' soin.id %}" 
                   class="btn btn-warning"
                   onclick="return confirm('Êtes-vous sûr de vouloir rejeter ce soin ?')">
                   <i class="fas fa-times-circle"></i> Rejeter le soin
                </a>
            </div>
        </div>
    </div>
    {% endif %}

    <!-- Section des prescriptions -->
    {% if prescriptions %}
    <div class="card mt-4">
        <div class="card-header">
            <h5 class="card-title mb-0">Prescriptions</h5>
        </div>
        <div class="card-body">
            <div class="table-responsive">
                <table class="table table-striped">
                    <thead>
                        <tr>
                            <th>Médicament</th>
                            <th>Posologie</th>
                            <th>Durée</th>
                            <th>Date prescription</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for prescription in prescriptions %}
                        <tr>
                            <td>{{ prescription.medicament }}</td>
                            <td>{{ prescription.posologie }}</td>
                            <td>{{ prescription.duree_traitement }}</td>
                            <td>{{ prescription.date_prescription|date:"d/m/Y" }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    {% endif %}

    <!-- Section des documents -->
    {% if documents %}
    <div class="card mt-4">
        <div class="card-header">
            <h5 class="card-title mb-0">Documents associés</h5>
        </div>
        <div class="card-body">
            <div class="list-group">
                {% for document in documents %}
                <a href="{{ document.fichier.url }}" class="list-group-item list-group-item-action" target="_blank">
                    <i class="fas fa-file-pdf text-danger"></i> {{ document.nom }}
                </a>
                {% endfor %}
            </div>
        </div>
    </div>
    {% endif %}
</div>
{% endblock %}